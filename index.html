<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Edit</title>
    <style>
      :root {
        --bg: #121212;
        --text: #d4d4d4;
        --accent: #3794ff;
        --header: #1e1e1e;
      }

      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        background-color: var(--bg);
        color: var(--text);
        font-family: 'Consolas', 'Monaco', monospace;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      header {
        padding: 8px 15px;
        background: var(--header);
        display: flex;
        gap: 12px;
        align-items: center;
        border-bottom: 1px solid #333;
        user-select: none;
      }

      button {
        background: #2d2d2d;
        color: #ccc;
        border: 1px solid #444;
        padding: 5px 12px;
        cursor: pointer;
        font-size: 13px;
        border-radius: 3px;
      }

      button:hover {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }

      #file-info {
        font-size: 12px;
        color: #777;
      }

      textarea {
        flex-grow: 1;
        background: var(--bg);
        color: var(--text);
        border: none;
        padding: 20px;
        font-size: 15px;
        line-height: 1.6;
        resize: none;
        outline: none;
        caret-color: var(--accent);
      }
    </style>
  </head>
  <body>
    <header id="ui-header" inert>
      <button onclick="openFile()">Open</button>
      <button onclick="saveFile()">Save</button>
      <span id="file-info">No file selected</span>
    </header>
    <textarea id="editor" spellcheck="false"></textarea>
    <script>
      let fileHandle;
      let isDirty = false;
      const editor = document.getElementById('editor');
      const fileInfo = document.getElementById('file-info');
      const header = document.getElementById('ui-header');
      document.addEventListener('mousemove', (e) => {
        if (e.clientY < 60) {
          header.removeAttribute('inert');
        } else {
          header.setAttribute('inert', '');
        }
      });
      editor.addEventListener('input', () => {
        if (!isDirty) {
          isDirty = true;
          updateFileInfo();
        }
      });
      window.addEventListener('beforeunload', (e) => {
        if (isDirty) {
          e.preventDefault();
          e.returnValue = '';
        }
      });

      function updateFileInfo() {
        const name = fileHandle ? fileHandle.name : 'Unsaved File';
        fileInfo.innerText = `${isDirty ? 'â— ' : ''}${name}`;
      }
      async function openFile() {
        try {
          [fileHandle] = await window.showOpenFilePicker();
          const file = await fileHandle.getFile();
          editor.value = await file.text();
          isDirty = false;
          fileInfo.innerText = `Editing: ${file.name}`;
        } catch (err) {}
      }
      async function saveFile() {
        if (!fileHandle) {
          try {
            fileHandle = await window.showSaveFilePicker();
          } catch (err) {
            return;
          }
        }
        const writable = await fileHandle.createWritable();
        await writable.write(editor.value);
        await writable.close();
        isDirty = false;
        fileInfo.innerText = `Saved: ${new Date().toLocaleTimeString()} - ${fileHandle.name}`;
      }
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 's') {
          e.preventDefault();
          saveFile();
        }
      });
      editor.addEventListener('keydown', (e) => {
        if (e.key === 'Tab') {
          e.preventDefault();
          const start = editor.selectionStart;
          const end = editor.selectionEnd;
          editor.value = editor.value.substring(0, start) + "  " + editor.value.substring(end);
          editor.selectionStart = editor.selectionEnd = start + 2;
        }
      });
    </script>
  </body>
</html>